<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Camera Test</title>
  <style>
    :root { color-scheme: dark light; }
    body { margin: 0; font-family: system-ui, sans-serif; display: grid; place-items: center; min-height: 100dvh; gap: 16px; }
    video { width: min(90vw, 600px); aspect-ratio: 16/9; background:#000; border-radius: 12px; }
    button { padding: .7rem 1rem; border-radius: 10px; border: 1px solid #999; background: #eee; cursor: pointer; }
  </style>
</head>
<body>
  <button id="btn">Start Camera</button>
  <video id="v" autoplay playsinline muted></video>

  <script>
    const btn = document.getElementById('btn');
    const video = document.getElementById('v');

    async function startCamera() {
      // Try rear camera first; fall back to any camera if needed
      const constraintsList = [
        { video: { facingMode: { ideal: 'environment' } }, audio: false },
        { video: true, audio: false }
      ];
      let stream, lastError;
      for (const c of constraintsList) {
        try {
          stream = await navigator.mediaDevices.getUserMedia(c);
          break;
        } catch (e) { lastError = e; }
      }
      if (!stream) {
        alert('Could not start camera: ' + (lastError?.message || 'unknown error'));
        return;
      }
      video.srcObject = stream;
      // iOS sometimes needs a play() after a gesture
      try { await video.play(); } catch {}
      btn.textContent = 'Camera running';
      btn.disabled = true;
    }

    // Safari/iOS requires user gesture â†’ click to start
    btn.addEventListener('click', startCamera);

    // Helpful checks
    if (!('mediaDevices' in navigator && 'getUserMedia' in navigator.mediaDevices)) {
      btn.disabled = true;
      alert('getUserMedia not supported in this browser.');
    }
  </script>
</body>
</html>
